---
title: "les 6-5"
output:
  html_document: default
  pdf_document: default
date: "2024-05-06"
---

# Logboek kiemgroenten

## Introductie

Blablablabablaballa kiemgroenten

- Wat is er al bekend
- IdeeÃ«n onderzoeksopzet
- Is er al data
- Verwijzing naar protocollen

## 06-05-2024 -- gelogd door [naam]
ik heb dit gedaan en dat gedaan

`dit is code`

### 2024-05-07
Om alvast te kijken hoe we met de data om kunnen gaan, ga ik een basic dataframe maken van 1 van de planten.
In deze dataframe komt alleen maar de groei van de plant en de oplossing zout te staan.
Met deze data wordt een histogram gemaakt.


```{r}
library(tidyverse)
set.seed(0)
cress_data <- data.frame(species = rep(c("cress", "alfalfa"), each=400),
                       N = 1:200,
                       batch_n=rep(c(1, 2), each=200),
                       Oplossing=rep(c(0,1,2,3), each=50),
                       cm_groei=c(rnorm(n=50, 5, 1.5),rnorm(n=50, 8,1),rnorm(n=50, 3, 2),rnorm(n=50, 1,0.5), #cress batch 1
                                  rnorm(n=50, 5.5, 1.6),rnorm(n=50, 7.6,1.2),rnorm(n=50, 2.8, 2.1),rnorm(n=50, 1.2,0.6), #cress batch 2
                                  rnorm(n=50, 3, 1),rnorm(n=50, 4,0.8),rnorm(n=50, 2, 0.5),rnorm(n=50, 1,0.2),#alfalfa batch 1
                                  rnorm(n=50, 3.2, 1.1),rnorm(n=50, 3.8,1.1),rnorm(n=50, 2.1, 0.4),rnorm(n=50, 1.2,0.1)), #aflalfa batch 2

                       n_ontkieming=c(rbinom(50, 1, 0.6), rbinom(50, 1, 0.8), rbinom(50, 1, 0.4), rbinom(50, 1, 0.2),
                                      rbinom(50, 1, 0.5), rbinom(50, 1, 0.7), rbinom(50, 1, 0.5), rbinom(50, 1, 0.25),
                                      rbinom(50, 1, 0.7), rbinom(50, 1, 0.9), rbinom(50, 1, 0.3), rbinom(50, 1, 0.3),
                                      rbinom(50, 1, 0.4), rbinom(50, 1, 0.8), rbinom(50, 1, 0.6), rbinom(50, 1, 0.35)),
                       
                       n_blaadjes=c(rnorm(n=50, 3, 1),rnorm(n=50, 4, 1),rnorm(n=50, 2, 1),rnorm(n=50, 1, 0.5), # C batch 1
                                    rnorm(n=50, 3, 1),rnorm(n=50, 4, 1),rnorm(n=50, 2, 1),rnorm(n=50, 1, 0.5), # C batch 2
                                    rnorm(n=50, 3, 1),rnorm(n=50, 4, 1),rnorm(n=50, 2, 1),rnorm(n=50, 1, 0.5), # A batch 1
                                    rnorm(n=50, 3, 1),rnorm(n=50, 4, 1),rnorm(n=50, 2, 1),rnorm(n=50, 1, 0.5))) # A batch 2
cress_data
```
Hierboven is de dataset gegenereerd

```{r}
cress_new <- cress_data %>%
    select(-batch_n)
cress_new <- cress_new[order(cress_new$Oplossing),]
cress_new
aggregate(cm_groei ~ species + Oplossing,data=cress_data, FUN=mean)
```
### 2024-05-08
Na de les van michiel moesten we eerst bekijken of de data compleet is.
Omdat deze data gesimuleerd is, is dit overbodig. Het moet daarintgen wel in onze echte analyse. Dus verwerk ik dit hier nju

```{r}
head(cress_data)
```
De correcte datatypen komen voor in de data set, ook is de header correct.

Het volgende wat gecheckt moet worden is of het aantal observaties overeenkomt met de dataset

```{r}
str(cress_data)
```
800 observaties komt overeen met de 800 zaadjes die geteld en geplant zijn.


0,1,2,3 nieuwe concentraties

## 2024-05-09
- 5 liter water gekookt voor 5 minuten.
- 5, 10, 15 gram zout gewogen
- deze heb ik opgelost in 3x500 ml water
- dit zorgt voor 3 verschillende concentraties: 1,2,3% zout
- Deze oplossingen zijn in een eigen spuitfles gedaan.
- 500 ml water zonder opgeloste zout ook in een eigen spuitfles gedaan.

- 16 petrischaaltjes gelabeled met soort, batch n en % oplossing
- 1 keukenpapiertje per schaaltje 2x dubbel gevouwen en gespoten met de oplossing die bij het schaaltje hoort tot het vochtig is aan de bovenkant.
- keukenpapiertje in schaaltje gedaan en 50 zaadjes er over heen gestrooid.
- zaadjes gespoten met correcte oplossing water na het het strooien.


## 2024-05-10
- 8:40: papier was droog, dus heb elk bakje 2x bemist

Een goede manier om voor elke oplossing een t test te doen tussen de 2 soorten
```{r}
cress_data %>%
    filter(Oplossing == 0) %>%
    t.test(cm_groei ~ species, data=.)
```

Om de spreiding weer te geven tussen de 2 batches op elke oplossing van de cress kan je een boxplot gebruiken, zie hieronder
```{r}
test <- cress_data %>%
    filter(species == "cress")
boxplot(cm_groei ~ batch_n + Oplossing, data=test)
```

## 2024-05-11
- Omdat het papier uitdroogt spuit ik elke ochtend en avond om 9 uur 2x in elk bakje.
Ook laat ik het dekseltje met een klein spleetje open op het bakje, zodat het vocht in het bakje blijft

## 2024-05-12
Vanwege een fout tijdens het 1e experiment, wat heeft geleid tot extreme uitdroging hebben we besloten overnieuw te beginnen

- zelfde stappen als voorheen
- nu vanaf het begin het dekseltje op het bakje gelaten, zodat de bodem niet uitdroogt.

## 2024-05-13
- 10 uur in de ochtend 2 keer water gespoten op de zaadjes

Er moet vast een manier zijn om een functie meerdere keren te herhalen, en die data op te slaan.
Om dit te testen experimenteer ik met lapply, met het uitvoeren van meerdere t-testen
```{r}
# Zo kan je voor elke oplossing kijken of er een significante afwijking is in verhouding met 0%
lijstje <- sapply(1:3, function(x){
    y <-cress_new %>%
        filter(Oplossing == 0 | Oplossing == x) %>%
        filter(species == "cress") %>%
        t.test(cm_groei ~ Oplossing, data = .)})

# Dit gebeurt er boven ^
x1 <- cress_data %>%
    filter(Oplossing == 0 | Oplossing == 1) %>%
    filter(species == "cress") %>%
    t.test(cm_groei ~ Oplossing, data = .)

x2 <- cress_data %>%
    filter(Oplossing == 0 | Oplossing == 2) %>%
    filter(species == "cress") %>%
    t.test(cm_groei ~ Oplossing, data = .)

x3 <- cress_data %>%
    filter(Oplossing == 0 | Oplossing == 3) %>%
    filter(species == "cress") %>%
    t.test(cm_groei ~ Oplossing, data = .)
```
Zo krijg je als output de t-test uitslagen van het verschil van cm_groei tussen oplossing van 0% en de overige oplossingen.


## 14-05-2024
- Plantjes water gegeven om 9 uur.

Vandaag hebben we geleerd hoe we om kunnen gaan met percentages, dit is relevant voor onze ontkieming.

```{r}
data_set_ontkieming <- cress_data %>%
    select(n_ontkieming, species, Oplossing)
data_set_ontkieming
ontkieming_table <- table(data_set_ontkieming$species, data_set_ontkieming$Oplossing+data_set_ontkieming$n_ontkieming)
(ontkieming_table)
```

Nu kunnen we een proptest doen om te kijken of er verschil is tussen de 2 soorten planten
```{r}
str(ontkieming_table)
```
Om het verschil te kunnen zien tussen de 2 soorten en n ontkiemingen kan je een 2-way chisq-test uitvoeren:
```{r}
(res <- chisq.test(x = ontkieming_table))
cat(sprintf("De p-waarde is groter dan 0.05: %.2f\n", res$p.value))
```
De p-waarde is hoger dan 0.05, dit houd in dat er geen significant verschil is tussen de 2 planten soorten.
Om te weten of het een relevant verschil is, moet je de effectsterkte berekenen.
Voor proportie gebruik ik Cohen's W
```{r}
chi2 <- res$statistic
N <- sum(ontkieming_table)
W <- sqrt(chi2 / N)
df <- res$parameter
cat(sprintf("Cohens W: %.3f", W))

```
Cohens W ligt bij 0.10, er is dus een zwak verband tussen de invloed op aantal ontkiemde zaadjes tussen soort plant en zoutoplossing.

Nu we een conclusie hebben moeten we berekenen of die correct is of niet.
Dit kan door de power te berekenen:
```{r}
library(pwr)

alpa <- 0.05
pwr.chisq.test(w=W, N=N, df=df, sig.level = alpa)
```
Hier is de power 0.61
Daarmee kunnen we zeggen dat onze conclusie, er is geen sigfnicant verschil gevonden van het aantal ontkiemde zaadjes tussen de 2 planten over de verschillende oplossingen, een 61% kans heeft om correct te zijn.

Hoeveel metingen hebben we nodig om 0.8 power te krijgen, met een W van 0.1?
```{r}
pwr.chisq.test(w = 0.1, df = df, sig.level = alpa, power = 0.80)
```
Dan zouden we dus 1194 planten moeten meten, zo'n 600 per planten soort.

## 2024-05-15
- 7:30 planten water gegeven


We hebben voor cm_groei een boxplot gemaakt via de basic boxplot functie van R.
Graag zou ik alle plots willen maken via de ggplot library.
```{r}
cress_data%>%
    filter(species == "cress") %>%
    ggplot(mapping = aes(x = as.character(Oplossing), y = cm_groei, fill = as.character(batch_n), ))+
    labs(y = "groei (cm)",
         x = "Oplossing zout (%)",
         title = "Spread of cress growth",
         subtitle = "For 0-3% salt",
         fill="batch n")+
    scale_fill_brewer(palette = "YlGn") + 
    geom_boxplot(outlier.color = "red",)
```
Zo is de boxplot wat mooier en makkelijker af te lezen.
Hetzelfde kan gedaan worden voor de andere planten soort
```{r}
cress_data %>%
    mutate(species_batch = fct_cross(species, as.character(batch_n), sep = "_")) %>%
    ggplot(mapping = aes(x = as.character(Oplossing), y = cm_groei, fill = species_batch,)) +
        labs(y = "groei (cm)",
         x = "Oplossing zout (%)",
         title = "Spread of plant growth",
         subtitle = "For 0-3% salt",
         fill="species_batchN") +
    scale_fill_brewer(palette = "YlGn") +
    geom_boxplot(outlier.color = "red")
```
Dit is best onleesbaar, vooral oplossing 3. Een betere manier om dit te doen is dit te plotten is losse charts op 1 pagina.
Dit kan met een library
```{r}
library(gridExtra)
plot_data_func <- function (data, variable_oplossing){
    data %>%
        filter(Oplossing == variable_oplossing) %>%
        ggplot(mapping = aes(x = species, y = cm_groei, fill=as.character(batch_n))) +
        labs(y = "groei (cm)",
         x = "Soort plant",
         title = "Spread of plant growth",
         subtitle = sprintf("For %i salt", variable_oplossing),
         fill="batch n") +
        scale_fill_brewer(palette = "YlGn") +
        geom_boxplot(outlier.color = "red")
        
}
```

Functie is gemaakt om makkelijk te plotten
```{r}
p1 <- plot_data_func(cress_data, 0)
p2 <- plot_data_func(cress_data, 1)
p3 <- plot_data_func(cress_data, 2)
p4 <- plot_data_func(cress_data, 3)
grid.arrange(p1, p2, p3 ,p4)
```
<br>

Er kan op deze manier ook een histogram gemaakt worden die het aantal ontkiemde zaadjes bevat
```{r}
cress_data %>%
    mutate(species_batch = fct_cross(species, as.character(batch_n), sep="_")) %>%
    filter(n_ontkieming == 1) %>%
    ggplot(mapping = aes(x = Oplossing, fill = species_batch),) +
    
    labs(y = "N ontkiemde zaadjes",
         x = "Oplossing zout (%)",
         title = "Histogram van N ontkiemde zaadjes",
         subtitle = "For 0-3% salt",
         fill="spcies_batchN") +
    
    scale_fill_brewer(palette = "Dark2") +
    
    geom_histogram(position = position_dodge(0.53),
                   binwidth = 0.3,)+
    
    stat_bin(aes(label= ifelse(after_stat(count)>0, after_stat(count), "")),
             geom = "text", binwidth = 0.3, position = position_dodge(0.53), vjust=-.45)
```


